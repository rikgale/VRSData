#!/bin/bash

LOGFILE="/home/richard/logs/cron-jobs.log"

# Use tee if running interactively, otherwise just redirect for cron
# This way, output goes to both terminal and logfile
if [[ -t 1 ]]; then
    # stdout is a terminal → pipe through tee
    exec > >(tee -a "$LOGFILE") 2>&1
else
    # cron → just append to log
    exec >> "$LOGFILE" 2>&1
fi

log() {
    echo "VRSData [$(date '+%Y-%m-%d %H:%M:%S')] [$0] $*"
}

log "AUTOUPDATE script started"

cd "$(dirname "${BASH_SOURCE[0]}")" || exit 1

# Pull latest changes quietly
git pull --ff-only --quiet

# Check for local changes
if [[ -n $(git status --porcelain) ]]; then
    log "Changes found. Pushing updates..."
    git add -A
    git commit -m "Updated $(date +%Y-%m-%d)"
    git push --quiet
    log "Changes pushed"
else
    log "No changes found. Nothing pushed"
fi

log "AUTOUPDATE script finished"
